Drupal.behaviors.acas = {
    attach: function(context, settings) {
        var ua = window.navigator.userAgent;
        var msie = ua.indexOf("MSIE ");
        if (msie > 0) {
            jQuery("body").addClass("ie" + parseInt(ua.substring(msie + 5, ua.indexOf(".", msie))));
        }
        document.body.style.display = "block";
        jQuery("a").each(function() {
            if (jQuery(this).attr("href")) {
                if (jQuery(this).attr("href").indexOf("http") != -1) {
                    jQuery(this).attr("target", "_blank");
                    jQuery(this).addClass("link--external");
                }
            }
        });
        document.getElementById("menu-primary__icon").addEventListener("click", function(e) {
            e.preventDefault();
            openNavigation();
        });
        if (document.documentElement.clientWidth < 768) {
            var primaryListItems = document.getElementsByClassName("menu-primary__item");
            for (var i = 0; i < primaryListItems.length; i++) {
                var primaryLink = primaryListItems[i].querySelectorAll(".menu-primary__link")[0];
                primaryLink.addEventListener("click", function(e) {
                    e.preventDefault();
                    if (this.parentNode.classList.contains("menu-primary__item--active")) {
                        this.parentNode.classList.remove("menu-primary__item--active");
                    } else {
                        this.parentNode.classList.add("menu-primary__item--active");
                    }
                });
            }
        }
    }
};

function openNavigation() {
    var x = document.getElementById("menu-primary");
    if (x.className === "menu-primary") {
        x.className += " menu-primary--active";
    } else {
        x.className = "menu-primary";
    }
}

jQuery(document).ready(function($) {
    var secondaryMenus = $(".menu-secondary");
    for (var i = 0; i < secondaryMenus.length; i++) {
        var siblingLink = $(secondaryMenus[i]).siblings(".menu-primary__link");
        var secondaryMenuTitle = "<li class='menu-secondary__title'><h3>" + $(siblingLink).clone().html() + "</h3></li>";
        $(secondaryMenus[i]).prepend(secondaryMenuTitle);
    }
    $("#edit-keys").on("click focus", function() {
        $(".form--inline").addClass("active");
    });
    $("#edit-keys").on("focusout", function() {
        $(".form--inline").removeClass("active");
    });
    $(".menu-primary__item").on("mouseenter focus", ".menu-primary__item > .menu-primary__link", function(e) {
        var el = $(this);
        setTimeout(function() {
            el.toggleClass("has-focus");
        }, 100);
        el.parents(".menu-primary__item").attr("aria-expanded", "true");
    }).on("mouseleave blur", ".menu-primary__item > .menu-primary__link", function(e) {
        var el = $(this);
        el.toggleClass("has-focus");
        setTimeout(function() {
            if (el.siblings(".menu-secondary").attr("data-has-focus") !== "true") {
                el.parents(".menu-primary__item").attr("aria-expanded", "false");
            }
        }, 100);
    }).on("mouseenter focusin", ".menu-secondary", function(e) {
        var el = $(this);
        el.attr("data-has-focus", "true");
    }).on("mouseleave focusout", ".menu-secondary", function(e) {
        var el = $(this);
        setTimeout(function() {
            if (el.find(":focus").length === 0) {
                el.attr("data-has-focus", "false");
                if (el.siblings(".menu-primary__link.has-focus").length === 0) {
                    el.parents(".menu-primary__item").attr("aria-expanded", "false");
                }
            }
        }, 100);
    });
});